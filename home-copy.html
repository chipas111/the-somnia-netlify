<!DOCTYPE html><!--  Last Published: Sat May 31 2025 07:38:01 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="68118485c8c4c74ad0e217ff" data-wf-site="67d67edc3ed28aa00cd5d1c0">
<head>
  <meta charset="utf-8">
  <title>Hero</title>
  <meta content="Hero" property="og:title">
  <meta content="Hero" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/the-somnia.webflow.css" rel="stylesheet" type="text/css">
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.jpg" rel="apple-touch-icon">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js" defer=""></script>
  <style>
    *,
    ::after,
    ::before {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
    }
    body {
        -webkit-tap-highlight-color: transparent;
        -webkit-font-smoothing: subpixel-antialiased;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-overflow-scrolling: touch;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-scroll-chaining: none;
        overscroll-behavior: none;
    }
    @media (min-width: 991px) {
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    }
    input,
    textarea {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
    }
    ::-webkit-scrollbar {
        -ms-overflow-style: none;
        display: none;
        overflow: -moz-scrollbars-none;
        scrollbar-width: none;
        -ms-overflow-style: none;
        -ms-overflow-style: -ms-autohiding-scrollbar;
    }
    .grid {
        display: none;
    }
</style>
</head>
<body>
  <div class="w-embed">
    <style>
	 [data-filter="goo-6"] {
    will-change: filter;
    filter: url(#goo-6);
  }
</style>
    <!--  Фильтр SVG  -->
    <svg class="hidden" style="position: absolute; visibility: hidden; pointer-events: none;">
      <defs>
        <filter id="goo-6">
          <fegaussianblur in="SourceGraphic" stddeviation="0" result="blur"></fegaussianblur>
          <fecolormatrix in="blur" mode="matrix" values="1 0 0 0 0  
                0 1 0 0 0  
                1 0 1 0 0  
                0 0 0 12 -8" result="goo"></fecolormatrix>
          <feturbulence type="fractalNoise" basefrequency="1" numoctaves="1" seed="1" result="noise"></feturbulence>
          <fedisplacementmap in="goo" in2="noise" scale="0" result="displacement"></fedisplacementmap>
          <fecomposite in="SourceGraphic" in2="displacement" operator="atop"></fecomposite>
        </filter>
      </defs>
    </svg>
    <!--  Стили  -->
    <style>
[data-filter="goo-6"] {
    will-change: filter;
}
</style>
  </div>
  <div class="head-scene_code w-embed w-script">
    <div class="spline-wrapper">
      <div class="container3d">
        <canvas id="canvas3d"></canvas>
        <div class="blur-overlay"></div>
      </div>
    </div>
    <style>
    .spline-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      width: 100vw;
      height: 100vh;
      z-index: 998;
      pointer-events: none;
    }
    .container3d {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      pointer-events: none;
      position: relative;
    }
    #canvas3d {
      pointer-events: none;
      position: relative;
      z-index: 1;
    }
    /* Добавляем стили для поддержки размытия */
    .head_left, .head_right {
      will-change: filter;
      transition: filter 1.2s ease-out;
    }
    .blur-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
      opacity: 0;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      transition: opacity 0.3s ease-out;
    }
  </style>
    <!--  Import the necessary Spline runtime  -->
    <script async="" src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
      "imports": {
        "@splinetool/runtime": "https://unpkg.com/@splinetool/runtime@latest/build/runtime.js"
      }
    }
  </script>
    <!--  Custom JavaScript for loading Spline scene and handling interactions  -->
    <script type="module">
    import { Application } from '@splinetool/runtime';
    const canvas = document.getElementById('canvas3d');
    const spline = new Application(canvas);
    const buttonPreloader = document.getElementById('button_preloader');
    spline.load('https://prod.spline.design/5d5FvSOJKYDZPl8Y/scene.splinecode')
      .then(() => {
        const head = spline.findObjectByName('head_container');
        const headLeft = spline.findObjectByName('head_left');
        const headRight = spline.findObjectByName('head_right');
        const headWrapper = spline.findObjectByName('head_wrapper');
        // Функция для применения размытия
        const applyBlur = (intensity) => {
          // Пробуем разные способы применения размытия
          if (headWrapper) {
            // Способ 1: через material
            if (headWrapper.material) {
              headWrapper.material.blur = intensity;
            }
            // Способ 2: через материалы всех дочерних элементов
            headWrapper.traverse((child) => {
              if (child.material) {
                child.material.blur = intensity;
              }
            });
            // Способ 3: через кастомное свойство
            headWrapper.blurIntensity = intensity;
          }
          // Применяем размытие к отдельным частям
          [headLeft, headRight].forEach(part => {
            if (part && part.material) {
              part.material.blur = intensity;
            }
          });
          // Применяем CSS-фильтр к canvas
          gsap.to("#canvas3d", {
            filter: `blur(${intensity}px)`,
            duration: 1.2,
            ease: "power2.out"
          });
        };
        if (head) {
          head.position.y = -100;
          const proxy = { y: -100 };
          buttonPreloader.addEventListener('click', () => {
            gsap.to(proxy, {
              y: -80,
              duration: 2,
              ease: "power3.out",
              onUpdate: () => {
                head.position.y = proxy.y;
              }
            });
          });
          ScrollTrigger.create({
            trigger: ".content-section",
            start: "top center",
            end: "bottom center",
            onEnter: () => {
              gsap.to(proxy, {
                y: -40,
                duration: 1.2,
                ease: "power2.out",
                onUpdate: () => {
                  head.position.y = proxy.y;
                }
              });
            },
            onLeaveBack: () => {
              gsap.to(proxy, {
                y: -80,
                duration: 1.2,
                ease: "power2.out",
                onUpdate: () => {
                  head.position.y = proxy.y;
                }
              });
            }
          });
        }
        if (headLeft && headRight && window.ScrollTrigger) {
          const degToRad = (deg) => deg * (Math.PI / 180);
          const blurOverlay = document.querySelector('.blur-overlay');
          // Первый ScrollTrigger для начальной анимации
          ScrollTrigger.create({
            trigger: ".content-section",
            start: "top center",
            end: "bottom center",
            onEnter: () => {
              gsap.to(headLeft.position, {
                x: -0.7,
                duration: 1.2,
                ease: "power2.out"
              });
              gsap.to(headRight.position, {
                x: 0.7,
                duration: 1.2,
                ease: "power2.out"
              });
              gsap.to(headLeft.rotation, {
                y: -degToRad(10),
                duration: 1.2,
                ease: "power2.out"
              });
              gsap.to(headRight.rotation, {
                y: degToRad(10),
                duration: 1.2,
                ease: "power2.out"
              });
            },
            onLeaveBack: () => {
              gsap.to(headLeft.position, {
                x: 0,
                duration: 1.2,
                ease: "power2.out"
              });
              gsap.to(headRight.position, {
                x: 0,
                duration: 1.2,
                ease: "power2.out"
              });
              gsap.to(headLeft.rotation, {
                y: 0,
                duration: 1.2,
                ease: "power2.out"
              });
              gsap.to(headRight.rotation, {
                y: 0,
                duration: 1.2,
                ease: "power2.out"
              });
            }
          });
          // Второй ScrollTrigger для portal-track анимации
          ScrollTrigger.create({
            trigger: ".portal-track",
            start: "top center",
            end: "bottom center",
            onEnter: () => {
              /* Сначала запускаем размытие
              gsap.to(blurOverlay, {
                opacity: 1,
                duration: 0.3,
                ease: "power1.out"
              }); */
              // Затем анимируем движение
              gsap.timeline({delay: 0.1})
                .to(headLeft.position, {
                  x: -1,
                  z: 0.3,
                  y: -0.5,
                  duration: 1.2,
                  ease: "power2.out"
                })
                .to(headLeft.scale, {
                  x: 1.5,
                  y: 1.5,
                  z: 1.5,
                  duration: 1.2,
                  ease: "power2.out"
                }, "<")
                .to(headLeft.rotation, {
                  x: degToRad(-5),
                  y: degToRad(10),
                  z: degToRad(20),
                  duration: 1.2,
                  ease: "power2.out"
                }, "<");
              gsap.timeline({delay: 0.1})
                .to(headRight.position, {
                  x: 1,
                  z: 0.3,
                  y: -0.5,
                  duration: 1.2,
                  ease: "power2.out"
                })
                .to(headRight.scale, {
                  x: 1.5,
                  y: 1.5,
                  z: 1.5,
                  duration: 1.2,
                  ease: "power2.out"
                }, "<")
                .to(headRight.rotation, {
                  x: degToRad(-5),
                  y: degToRad(-10),
                  z: degToRad(-20),
                  duration: 1.2,
                  ease: "power2.out"
                }, "<");
            },
            onLeaveBack: () => {
              // При возврате сначала начинаем движение
              gsap.timeline()
                .to(headLeft.position, {
                  x: -0.7,
                  z: 0,
                  y: 0,
                  duration: 1.2,
                  ease: "power2.out"
                })
                .to(headLeft.scale, {
                  x: 1,
                  y: 1,
                  z: 1,
                  duration: 1.2,
                  ease: "power2.out"
                }, "<")
                .to(headLeft.rotation, {
                  x: 0,
                  y: degToRad(-10),
                  z: 0,
                  duration: 1.2,
                  ease: "power2.out"
                }, "<");
              gsap.timeline()
                .to(headRight.position, {
                  x: 0.7,
                  z: 0,
                  y: 0,
                  duration: 1.2,
                  ease: "power2.out"
                })
                .to(headRight.scale, {
                  x: 1,
                  y: 1,
                  z: 1,
                  duration: 1.2,
                  ease: "power2.out"
                }, "<")
                .to(headRight.rotation, {
                  x: 0,
                  y: degToRad(10),
                  z: 0,
                  duration: 1.2,
                  ease: "power2.out"
                }, "<");
              /* И чуть позже убираем размытие
              gsap.to(blurOverlay, {
                opacity: 0,
                duration: 0.3,
                delay: 0.2,
                ease: "power1.out"
              });*/
            }
          });
        } else {
          console.warn("⚠️ head_left или head_right не найдены, либо ScrollTrigger не подключён");
        }
      });
  </script>
  </div>
  <div class="scroll-content_embed w-embed w-script">
    <script>
// Создание структуры прогресс-бара
const createProgressBar = (targetSelector) => {
    const targetElement = document.querySelector(targetSelector);
    if (!targetElement) {
        console.warn(`Target element ${targetSelector} not found`);
        return;
    }
    // Создаем структуру прогресс-бара
    const progressContainer = document.createElement('div');
    progressContainer.className = 'progress-container';
    progressContainer.style.cssText = `
        position: fixed;
        top: 30%;
        left: 50%;
        transform: translateX(-50%);
        width: 10%;
        max-width: 300px;
        z-index: 800;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s ease, visibility 0.4s ease;
    `;
    const progressBar = document.createElement('div');
    progressBar.className = 'progress-bar';
    progressBar.style.cssText = `
        width: 100%;
        height: 2px;
        background: rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
    `;
    // Создаем 6 секций
    for (let i = 1; i <= 6; i++) {
        const section = document.createElement('div');
        section.className = 'progress-section';
        section.setAttribute('data-section', i);
        section.style.cssText = `
            flex: 1;
            position: relative;
            margin: 0 2px;
            ${i === 1 ? 'margin-left: 0;' : ''}
            ${i === 6 ? 'margin-right: 0;' : ''}
        `;
        const fill = document.createElement('div');
        fill.className = 'progress-fill';
        fill.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 0%;
            height: 100%;
            background: white;
            transform-origin: left;
        `;
        section.appendChild(fill);
        progressBar.appendChild(section);
    }
    progressContainer.appendChild(progressBar);
    targetElement.appendChild(progressContainer);
};
// Функция для анимации прогресс-бара
const animateProgressSection = (sectionIndex, progress) => {
    const section = document.querySelector(`.progress-section[data-section="${sectionIndex + 1}"] .progress-fill`);
    if (section) {
        gsap.to(section, {
            width: `${progress * 100}%`,
            duration: 0.1,
            ease: "none"
        });
    }
};
// Функции для управления видимостью прогресс-бара
const showProgressBar = () => {
    const container = document.querySelector('.progress-container');
    if (container) {
        gsap.to(container, {
            opacity: 1,
            duration: 0.4,
            ease: "power2.inOut",
            onStart: () => {
                container.style.visibility = 'visible';
            }
        });
    }
};
const hideProgressBar = () => {
    const container = document.querySelector('.progress-container');
    if (container) {
        gsap.to(container, {
            opacity: 0,
            duration: 0.4,
            ease: "power2.inOut",
            onComplete: () => {
                container.style.visibility = 'hidden';
            }
        });
    }
};
// Функция принудительного скрытия прогресс-бара
const forceHideProgressBar = () => {
    const container = document.querySelector('.progress-container');
    if (container) {
        gsap.killTweensOf(container);
        container.style.opacity = '0';
        container.style.visibility = 'hidden';
    }
};
// Функция принудительного показа прогресс-бара
const forceShowProgressBar = () => {
    const container = document.querySelector('.progress-container');
    if (container) {
        gsap.killTweensOf(container);
        container.style.opacity = '1';
        container.style.visibility = 'visible';
    }
};
// Функция инициализации текстового эффекта
function initTextEffect(text) {
    const feBlur = document.querySelector('#goo-6 feGaussianBlur');
    const feTurbulence = document.querySelector('#goo-6 feTurbulence');
    const feDisplacementMap = document.querySelector('#goo-6 feDisplacementMap');
    // Объект для хранения значений эффекта
    let primitiveValues = { stdDeviation: 0, scale: 0, baseFrequency: 0 };
    return {
        show: () => {
            const tl = gsap.timeline({
                defaults: {
                    duration: 1.2,
                    ease: 'expo.out',
                },
                onUpdate: () => {
                    feBlur.setAttribute('stdDeviation', primitiveValues.stdDeviation);
                    feDisplacementMap.setAttribute('scale', primitiveValues.scale);
                    feTurbulence.setAttribute('baseFrequency', primitiveValues.baseFrequency);
                }
            });
            tl.fromTo(primitiveValues, 
                { 
                    stdDeviation: 90,
                    scale: 300,
                    baseFrequency: 0.1
                },
                {
                    stdDeviation: 0,
                    scale: 0,
                    baseFrequency: 0.01
                }
            )
            .fromTo(text, 
                {
                    opacity: 0,
                    scale: 0.7,
                    visibility: 'visible'
                },
                {
                    opacity: 1,
                    scale: 1,
                    visibility: 'visible'
                },
                0
            );
            return tl;
        },
        hide: () => {
            const tl = gsap.timeline({
                defaults: {
                    duration: 1.2,
                    ease: 'expo.in',
                },
                onUpdate: () => {
                    feBlur.setAttribute('stdDeviation', primitiveValues.stdDeviation);
                    feDisplacementMap.setAttribute('scale', primitiveValues.scale);
                    feTurbulence.setAttribute('baseFrequency', primitiveValues.baseFrequency);
                }
            });
            tl.to(primitiveValues, 
                {
                    stdDeviation: 90,
                    scale: 300,
                    baseFrequency: 0.1
                }
            )
            .to(text, 
                {
                    opacity: 0,
                    scale: 0.7
                },
                0
            )
            .set(text, { visibility: 'hidden' }); // Скрываем элемент после анимации
            return tl;
        }
    };
}
// Инициализация анимаций для content-section
const initContentAnimations = () => {
    // Создаем прогресс-бар в указанном контейнере
    createProgressBar('.scroll_content');
    // Получаем все параграфы
    const paragraphs = gsap.utils.toArray('.content_wrap[class*="para-"]');
    if (!paragraphs.length) {
        console.warn('No paragraphs found with class content_wrap para-*');
        return;
    }
    // Флаги для отслеживания состояния
    let isAnimating = false;
    let currentAnimation = null;
    let lastParaVisible = false;
    let firstParaVisible = false;
    // Устанавливаем начальное состояние всех параграфов
    gsap.set(paragraphs, {
        opacity: 0,
        scale: 0.7,
        visibility: 'hidden'
    });
    // Функция для принудительного завершения текущей анимации
    const completeCurrentAnimation = () => {
        if (currentAnimation) {
            currentAnimation.progress(1);
            currentAnimation = null;
        }
    };
    // Модифицируем функцию анимации перехода
    const animateTransition = (currentPara, nextPara, reverse = false) => {
        if (isAnimating) {
            completeCurrentAnimation();
        }
        isAnimating = true;
        const firstPara = reverse ? nextPara : currentPara;
        const secondPara = reverse ? currentPara : nextPara;
        // Timeline для синхронизации анимаций
        const tl = gsap.timeline({
            onComplete: () => {
                isAnimating = false;
                currentAnimation = null;
                // Убеждаемся, что все параграфы, кроме активного, скрыты
                paragraphs.forEach(para => {
                    if (para !== (reverse ? firstPara : secondPara)) {
                        gsap.set(para, { visibility: 'hidden', opacity: 0, scale: 0.7 });
                    }
                });
            }
        });
        currentAnimation = tl;
        // Создаем эффекты для обоих параграфов
        const firstEffect = initTextEffect(firstPara);
        const secondEffect = initTextEffect(secondPara);
        // Сначала скрываем все параграфы, кроме тех, с которыми работаем
        paragraphs.forEach(para => {
            if (para !== firstPara && para !== secondPara) {
                gsap.set(para, { visibility: 'hidden', opacity: 0, scale: 0.7 });
            }
        });
        // Устанавливаем начальные состояния для анимируемых параграфов
        gsap.set(firstPara, { visibility: 'visible' });
        gsap.set(secondPara, { visibility: 'visible' });
        if (reverse) {
            tl.add(secondEffect.hide())
              .add(firstEffect.show(), ">-0.4");
        } else {
            tl.add(firstEffect.hide())
              .add(secondEffect.show(), ">-0.4");
        }
        return tl;
    };
    // Создаем ScrollTrigger для каждого параграфа, включая первый
    paragraphs.forEach((para, index) => {
        const isFirst = index === 0;
        const isLast = index === paragraphs.length - 1;
        const nextPara = paragraphs[index + 1];
        const prevPara = paragraphs[index - 1];
        if (isFirst) {
            // Триггер для первого параграфа
            ScrollTrigger.create({
                trigger: ".scroll-trigger.one",
                start: "top 80%",
                end: "bottom center",
                onUpdate: (self) => {
                    animateProgressSection(0, self.progress);
                },
                onEnter: () => {
                    if (!firstParaVisible) {
                        firstParaVisible = true;
                        showProgressBar();
                        const effect = initTextEffect(para);
                        gsap.set(para, { visibility: 'visible' });
                        effect.show();
                    }
                },
                onLeaveBack: () => {
                    if (firstParaVisible) {
                        firstParaVisible = false;
                        hideProgressBar();
                        const effect = initTextEffect(para);
                        effect.hide();
                    }
                }
            });
        }
        // Создаем триггер для перехода к следующему параграфу
        if (nextPara) {
            const triggerNum = index + 1;
            ScrollTrigger.create({
                trigger: `.scroll-trigger.${getNumberWord(triggerNum + 1)}`,
                start: "top center",
                end: "bottom center",
                onUpdate: (self) => {
                    animateProgressSection(triggerNum, self.progress);
                },
                onEnter: () => {
                    // При входе в триггер показываем следующий параграф и скрываем текущий
                    animateTransition(para, nextPara, false);
                },
                onLeaveBack: () => {
                    // При выходе из триггера назад показываем текущий параграф и скрываем следующий
                    animateTransition(nextPara, para, false);
                }
            });
        }
        // Специальные триггеры для последнего параграфа
        if (isLast) {
            let lastScrollTime = Date.now();
            let scrollSpeed = 0;
            window.addEventListener('scroll', () => {
                const now = Date.now();
                const delta = now - lastScrollTime;
                scrollSpeed = delta < 50 ? 'fast' : 'normal';
                lastScrollTime = now;
            });
            ScrollTrigger.create({
                trigger: `.scroll-trigger.${getNumberWord(paragraphs.length)}`,
                start: "top center",
                end: "bottom center",
                onUpdate: (self) => {
                    animateProgressSection(paragraphs.length - 1, self.progress);
                    if (self.progress >= 0.99 && lastParaVisible) {
                        lastParaVisible = false;
                        if (!isAnimating) {
                            const effect = initTextEffect(para);
                            if (scrollSpeed === 'fast') {
                                effect.hide().timeScale(2);
                                forceHideProgressBar();
                            } else {
                                effect.hide();
                                hideProgressBar();
                            }
                        }
                    } else if (self.progress < 0.99 && !lastParaVisible) {
                        lastParaVisible = true;
                        if (!isAnimating) {
                            const effect = initTextEffect(para);
                            if (scrollSpeed === 'fast') {
                                effect.show().timeScale(2);
                                forceShowProgressBar();
                            } else {
                                effect.show();
                                showProgressBar();
                            }
                        }
                    }
                }
            });
        }
    });
};
// Вспомогательная функция для преобразования числа в слово
const getNumberWord = (num) => {
    const words = ['one', 'two', 'three', 'four', 'five', 'six'];
    return words[num - 1] || num.toString();
};
// Анимация для img-step
const initImgStepAnimation = () => {
    const imgStep = document.querySelector('.img-step');
    if (!imgStep) return;
    // Начальное состояние
    gsap.set(imgStep, {
        yPercent: 100,
        rotation: 0
    });
    // Триггер для появления (trigger.four)
    ScrollTrigger.create({
        trigger: '.scroll-trigger.four',
        start: 'top center',
        end: 'bottom center',
        onEnter: () => {
            gsap.to(imgStep, {
                yPercent: 0,
                duration: 1.2,
                ease: 'power2.out'
            });
        },
        onLeaveBack: () => {
            gsap.to(imgStep, {
                yPercent: 100,
                duration: 1.2,
                ease: 'power2.inOut'
            });
        }
    });
    // Триггер для первого поворота (trigger.five)
    ScrollTrigger.create({
        trigger: '.scroll-trigger.five',
        start: 'top center',
        end: 'bottom center',
        onEnter: () => {
            gsap.to(imgStep, {
                rotation: -90,
                duration: 1.2,
                ease: 'power2.inOut'
            });
        },
        onLeaveBack: () => {
            gsap.to(imgStep, {
                rotation: 0,
                duration: 1.2,
                ease: 'power2.inOut'
            });
        }
    });
    // Триггер для второго поворота и исчезновения (trigger.six)
    ScrollTrigger.create({
        trigger: '.scroll-trigger.six',
        start: 'top center',
        end: 'bottom center',
        onEnter: () => {
            gsap.to(imgStep, {
                rotation: -180,
                duration: 1.2,
                ease: 'power2.inOut'
            });
        },
        onLeaveBack: () => {
            gsap.to(imgStep, {
                rotation: -90,
                duration: 1.2,
                ease: 'power2.inOut'
            });
        },
        onUpdate: (self) => {
            // Когда прогресс достигает конца, запускаем исчезновение
            if (self.progress >= 0.99) {
                gsap.to(imgStep, {
                    yPercent: 100,
                    duration: 0.8,
                    ease: 'power2.in',
                    onComplete: () => {
                        imgStep.style.display = 'none';
                    }
                });
            } else if (self.progress < 0.99 && self.direction === -1) {
                // При скролле назад возвращаем на место
                imgStep.style.display = 'block';
                gsap.to(imgStep, {
                    yPercent: 0,
                    duration: 0.8,
                    ease: 'power2.out'
                });
            }
        }
    });
};
// Добавляем вызов функции в основную инициализацию
document.addEventListener('DOMContentLoaded', () => {
    initContentAnimations();
    initImgStepAnimation();
});
</script>
  </div>
  <div class="grid_wrap">
    <div class="grid_col"></div>
    <div class="grid_col"></div>
    <div class="grid_col"></div>
    <div class="grid_col"></div>
    <div class="grid_col"></div>
    <div class="code-embed w-embed">
      <style>
	.grid_wrap {
  	pointer-events: none;
  }
</style>
    </div>
  </div>
  <div data-w-id="74030356-d128-3a2b-b29f-bfc78356958f" style="-webkit-transform:translate3d(0, 0, 0) scale3d(0, 0, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(0, 0, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(0, 0, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(0, 0, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="cursor-wrapper">
    <div class="w-embed">
      <style>
	.cursor-wrapper, 
	.cursor,
  .cursor-mask,
  .cursor-text {
  	pointer-events: none;
  }
</style>
    </div>
    <div style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="cursor">
      <div class="cursor-mask">
        <p style="-webkit-transform:translate3d(0, 0rem, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0rem, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0rem, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0rem, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="cursor-text">scroll</p>
      </div>
    </div>
  </div>
  <div fs-scrolldisable-element="when-visible" data-w-id="4a7cbb60-0095-8cee-e55d-feb6b9a50bb9" class="pre_loader-wrap">
    <div class="pre_loader-inner">
      <div data-preserve-aspect-ratio="xMidYMid slice" data-w-id="b550c1c3-0be1-d667-3c76-00cebf09f9b8" data-is-ix2-target="1" class="preloader_lottie" data-animation-type="lottie" data-src="documents/preloader.json" data-loop="0" data-direction="1" data-autoplay="0" data-renderer="svg" data-default-duration="0" data-duration="8.008007681835174" data-ix2-initial-state="0"></div>
      <div class="glow-container">
        <div data-w-id="19a52509-a51f-7e8b-2440-620900b700a1" class="glow"></div>
      </div>
      <div id="button_preloader" button_preloader="" data-w-id="3ae248a6-024b-6fba-565c-e7ee534bf714" class="button_preloader">
        <div class="button_preloader-progress"></div>
        <div class="button_preloader-finished"></div>
        <div class="pre-loader_animation w-embed w-script">
          <script>
  document.addEventListener("DOMContentLoaded", function () {
    const counter = { value: 0 };
    const loaderDuration = 7;
    const easing = "cubic-bezier(0.77, 0, 0.175, 1)";
    const loaderEl = document.querySelector('.loader_number');
    const buttonEl = document.querySelector('.button_preloader');
    const finalText = "Enter";
    let hasGlitched = false;
    function updateLoaderText() {
      if (!loaderEl) return;
      const progress = Math.round(counter.value);
      if (progress >= 100 && !hasGlitched) {
        hasGlitched = true;
        glitchToText(loaderEl, finalText, 600); // glitch to "Enter"
      } else if (!hasGlitched) {
        loaderEl.textContent = progress;
      }
    }
    // Reusable glitch effect
    function glitchToText(el, target, duration = 1000, callback) {
      const chars = "!@#$%^&*()_+-=[]{}<>?~";
      let frame = 0;
      const maxFrames = Math.round(duration / 50);
      el.style.color = "#141414";
      const scramble = setInterval(() => {
        let output = "";
        for (let i = 0; i < target.length; i++) {
          output += Math.random() < 0.5
            ? chars[Math.floor(Math.random() * chars.length)]
            : target[i];
        }
        el.textContent = output;
        frame++;
        if (frame >= maxFrames) {
          clearInterval(scramble);
          el.textContent = target;
          if (callback) callback();
        }
      }, 50);
    }
    // === GSAP Timeline ===
    const tl = gsap.timeline();
    tl.to(counter, {
      value: 100,
      duration: loaderDuration,
      ease: easing,
      onUpdate: updateLoaderText
    });
    tl.to(".button_preloader-progress", {
      width: "100%",
      duration: loaderDuration,
      ease: easing
    }, 0);
    tl.to(".button_preloader-finished", {
      width: "100%",
      duration: 1,
      ease: easing
    });
    tl.call(() => {
      buttonEl.style.pointerEvents = 'auto';
    });
    // === Hover Glitch Effect ===
    buttonEl.addEventListener('mouseenter', () => {
      if (hasGlitched) {
        glitchToText(loaderEl, finalText, 300);
      }
    });
  });
</script>
        </div>
        <div class="loader_number"> </div>
        <div data-w-id="be86159e-c096-5b70-6694-2868af113d8a" class="button_corner-wrap">
          <div class="menu_crn-wrap is-top-l"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img is-blur"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img is-blur"></div>
          <div class="menu_crn-wrap is-top-r"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img is-blur"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img is-blur"></div>
          <div class="menu_crn-wrap is-btm-l"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img is-blur"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img is-blur"></div>
          <div class="menu_crn-wrap is-btm-r"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img is-blur"><img src="images/corner.svg" loading="lazy" alt="" class="corner-img is-blur"></div>
        </div>
      </div>
    </div>
    <div class="bg-sound w-embed w-script">
      <script>
  const ambientSound = new Howl({
    src: ['https://cdn.jsdelivr.net/gh/chipas111/the-somnia@dfaa7fc/bg-sound.mp3'],
    loop: true,
    volume: 0.4,
    html5: true
  });
  let isSoundPlaying = false;
  const preloaderButton = document.querySelector('.button_preloader');
  const soundToggle = document.querySelector('.menu_sound-wrap');
  // Start sound after preloader
  if (preloaderButton) {
    preloaderButton.addEventListener('click', function () {
      ambientSound.play();
      isSoundPlaying = true;
    });
  }
  // Toggle sound on/off
  document.addEventListener('click', function (e) {
    const toggleBtn = e.target.closest('.menu_sound-wrap');
    if (!toggleBtn) return; // if click is outside - do nothing
    if (isSoundPlaying) {
      ambientSound.pause();
      isSoundPlaying = false;
      toggleBtn.classList.add('muted');
    } else {
      ambientSound.play();
      isSoundPlaying = true;
      toggleBtn.classList.remove('muted');
    }
  });
</script>
    </div>
  </div>
  <div class="background">
    <div class="bg_image-container"></div>
    <div class="bg_glow-container">
      <div class="bg_glow-wrap is-left"><img src="images/glow-left.svg" loading="lazy" alt="" class="img"></div>
      <div class="bg_glow-wrap is-right"><img src="images/glow-right.svg" loading="lazy" alt="" class="img"></div>
    </div>
    <div class="stars-embed w-embed w-script">
      <style>
  .container {
    display: block;
    position: relative;
    width: 100%;
    height: 100vh;
    background: black;
  }
  .container .text {
    color: #FFF;
    position: absolute;
    top: 50%;
    right: 50%;
    margin: -10px -75px 0 0;
    font-size: 20px;
    font-family: sans-serif;
    font-weight: bold;
  }
  .stars {
    z-index: 10;
    width: 1px;
    height: 1px;
    border-radius: 50%;
    background: transparent;
    box-shadow: 718px 1689px #FFF , 1405px 2127px #FFF , 1270px 1148px #FFF , 620px 641px #FFF , 1538px 708px #FFF , 2169px 1632px #FFF , 523px 1494px #FFF , 1081px 2018px #FFF , 1372px 585px #FFF , 974px 576px #FFF , 448px 1231px #FFF , 78px 2055px #FFF , 1180px 1274px #FFF , 1752px 2099px #FFF , 1392px 488px #FFF , 1836px 2303px #FFF , 1309px 816px #FFF , 922px 962px #FFF , 1165px 2485px #FFF , 2054px 176px #FFF , 1425px 747px #FFF , 2253px 2056px #FFF , 1602px 114px #FFF , 433px 1332px #FFF , 65px 1726px #FFF , 257px 334px #FFF , 1512px 1855px #FFF , 775px 2422px #FFF , 2512px 2123px #FFF , 76px 2235px #FFF , 1979px 501px #FFF , 352px 1222px #FFF , 554px 1215px #FFF , 1200px 2163px #FFF , 2078px 1983px #FFF , 2461px 557px #FFF , 1960px 2055px #FFF , 1966px 316px #FFF , 1123px 1402px #FFF , 1461px 2288px #FFF , 1625px 2076px #FFF , 822px 609px #FFF , 531px 1358px #FFF , 900px 1938px #FFF , 1867px 1362px #FFF , 1049px 372px #FFF , 319px 980px #FFF , 2321px 2421px #FFF , 1701px 1425px #FFF , 1827px 1324px #FFF , 126px 1121px #FFF , 527px 1735px #FFF;
    animation: animStar 100s linear infinite;
  }
  .stars:after {
    content: " ";
    top: -600px;
    width: 1px;
    height: 1px;
    border-radius: 50%;
    position: absolute;
    backgroud: transparent;
    box-shadow: 1229px 1419px #FFF , 672px 2257px #FFF , 821px 854px #FFF , 731px 1239px #FFF , 1244px 58px #FFF , 687px 2428px #FFF , 173px 1549px #FFF , 1973px 940px #FFF , 2334px 1057px #FFF , 792px 882px #FFF , 1499px 1912px #FFF , 1892px 9px #FFF , 172px 1753px #FFF , 22px 1577px #FFF , 934px 2059px #FFF , 1398px 2309px #FFF , 100px 77px #FFF , 1545px 22px #FFF , 595px 1917px #FFF , 941px 1452px #FFF , 1226px 1022px #FFF , 1254px 990px #FFF , 2507px 352px #FFF , 111px 887px #FFF , 1666px 168px #FFF , 966px 986px #FFF , 121px 2559px #FFF , 1424px 792px #FFF , 1973px 2544px #FFF , 577px 503px #FFF , 1167px 1107px #FFF , 2397px 1653px #FFF , 1054px 810px #FFF , 663px 805px #FFF , 1084px 317px #FFF , 2214px 759px #FFF , 190px 975px #FFF , 2218px 2104px #FFF , 2013px 1227px #FFF , 383px 1778px #FFF , 1287px 1660px #FFF , 2131px 994px #FFF , 1073px 748px #FFF , 1745px 2372px #FFF , 1424px 252px #FFF , 1274px 2457px #FFF , 1976px 2422px #FFF , 1644px 1665px #FFF , 2372px 1772px #FFF , 1593px 580px #FFF , 894px 2361px #FFF , 31px 1802px #FFF , 1552px 1134px #FFF , 1477px 1847px #FFF , 1647px 2464px #FFF , 599px 510px #FFF , 2016px 226px #FFF , 1402px 243px #FFF , 748px 953px #FFF , 387px 1212px #FFF , 453px 1525px #FFF , 1032px 93px #FFF , 1420px 1399px #FFF , 146px 948px #FFF , 2256px 1631px #FFF , 1405px 394px #FFF , 201px 2149px #FFF , 1077px 1765px #FFF , 34px 2213px #FFF , 2388px 246px #FFF , 392px 667px #FFF , 1595px 181px #FFF , 323px 426px #FFF , 2405px 2410px #FFF , 2484px 280px #FFF;
  }
  .stars1 {
    z-index: 10;
    width: 2px;
    height: 2px;
    border-radius: 50%;
    background: transparent;
    box-shadow: 452px 2369px #FFF , 2030px 2013px #FFF , 113px 1775px #FFF , 426px 2228px #FFF , 735px 2395px #FFF , 483px 147px #FFF , 1123px 1666px #FFF , 1944px 113px #FFF , 1096px 372px #FFF , 2005px 118px #FFF , 1948px 2320px #FFF , 2095px 823px #FFF , 742px 1559px #FFF , 1637px 383px #FFF , 877px 992px #FFF , 141px 1522px #FFF , 483px 941px #FFF , 2028px 761px #FFF , 1164px 2482px #FFF , 692px 1202px #FFF , 1008px 62px #FFF , 1820px 2535px #FFF , 1459px 2067px #FFF , 519px 1297px #FFF , 1620px 252px #FFF , 1014px 1855px #FFF , 679px 135px #FFF , 1927px 2544px #FFF , 836px 1433px #FFF , 286px 21px #FFF , 1131px 769px #FFF , 1717px 1031px #FFF , 2121px 517px #FFF , 1865px 1257px #FFF , 1640px 1712px #FFF , 158px 162px #FFF , 2491px 1514px #FFF , 784px 1446px #FFF , 1547px 968px #FFF , 1966px 1461px #FFF , 923px 1883px #FFF , 601px 81px #FFF , 1486px 598px #FFF , 1947px 1462px #FFF , 2161px 1181px #FFF , 773px 675px #FFF , 2023px 455px #FFF , 1199px 1199px #FFF , 94px 1814px #FFF , 1055px 852px #FFF , 583px 631px #FFF , 150px 1931px #FFF , 1472px 597px #FFF , 611px 1338px #FFF , 54px 859px #FFF , 1266px 1019px #FFF , 1028px 256px #FFF , 1442px 964px #FFF , 436px 1325px #FFF , 2446px 1141px #FFF , 723px 70px #FFF , 825px 964px #FFF , 63px 271px #FFF , 647px 849px #FFF , 309px 673px #FFF , 1965px 2090px #FFF , 1672px 9px #FFF , 450px 2504px #FFF , 1675px 2135px #FFF , 2075px 921px #FFF , 1607px 2348px #FFF , 2243px 1494px #FFF;
    animation: animStar 125s linear infinite;
  }
  .stars1:after {
    content: " ";
    top: -600px;
    width: 2px;
    height: 2px;
    border-radius: 50%;
    position: absolute;
    backgroud: transparent;
    box-shadow: 435px 1410px #FFF , 1717px 2554px #FFF , 885px 1458px #FFF , 1614px 909px #FFF , 26px 2169px #FFF , 1627px 1343px #FFF , 511px 518px #FFF , 1388px 722px #FFF , 748px 1982px #FFF , 837px 2188px #FFF , 891px 1897px #FFF , 917px 2547px #FFF , 866px 2021px #FFF , 1748px 2464px #FFF , 409px 2476px #FFF , 1321px 1824px #FFF , 1946px 1620px #FFF , 84px 1996px #FFF , 773px 475px #FFF , 2327px 1356px #FFF , 181px 38px #FFF , 2122px 1291px #FFF , 2254px 375px #FFF , 654px 432px #FFF , 2022px 710px #FFF , 866px 1651px #FFF , 948px 2128px #FFF , 1107px 1282px #FFF , 1605px 1555px #FFF , 847px 2056px #FFF , 1678px 385px #FFF , 1723px 2282px #FFF , 516px 166px #FFF , 1764px 93px #FFF , 1947px 2302px #FFF , 1357px 1486px #FFF , 1237px 2532px #FFF , 2338px 2002px #FFF , 251px 1525px #FFF , 876px 1121px #FFF , 189px 759px #FFF , 1936px 1574px #FFF , 2510px 1440px #FFF , 204px 836px #FFF , 2044px 437px #FFF , 471px 45px #FFF , 394px 548px #FFF , 1730px 641px #FFF , 1526px 1701px #FFF , 1559px 1106px #FFF , 1396px 1826px #FFF , 1106px 644px #FFF , 160px 2149px #FFF , 1261px 1804px #FFF , 363px 714px #FFF , 2002px 2277px #FFF , 696px 1741px #FFF , 2291px 499px #FFF , 2089px 2229px #FFF;
  }
  .stars2 {
    z-index: 10;
    width: 3px;
    height: 3px;
    border-radius: 50%;
    background: transparent;
    box-shadow: 380px 1043px #FFF , 10px 1086px #FFF , 660px 1062px #FFF , 1371px 842px #FFF , 1290px 2153px #FFF , 2258px 231px #FFF , 2130px 2217px #FFF , 1084px 758px #FFF , 1464px 1903px #FFF , 621px 2482px #FFF , 2470px 754px #FFF , 1282px 1797px #FFF , 510px 1678px #FFF , 836px 799px #FFF , 2001px 134px #FFF , 2314px 1869px #FFF , 1031px 643px #FFF , 949px 292px #FFF , 16px 2265px #FFF , 465px 1239px #FFF , 2117px 1952px #FFF , 1683px 605px #FFF , 1818px 1945px #FFF , 890px 1749px #FFF , 324px 110px #FFF , 1048px 1442px #FFF , 2399px 1553px #FFF , 157px 551px #FFF , 666px 314px #FFF , 897px 933px #FFF , 2397px 438px #FFF , 1280px 988px #FFF , 1510px 2373px #FFF , 2453px 1645px #FFF , 831px 994px #FFF , 2125px 338px #FFF , 1571px 2128px #FFF , 1792px 53px #FFF , 820px 2480px #FFF , 529px 1544px #FFF , 1941px 928px #FFF , 1632px 795px #FFF , 152px 993px #FFF , 1040px 260px #FFF , 1131px 589px #FFF , 2395px 1336px #FFF , 1537px 1906px #FFF , 1989px 1910px #FFF , 1489px 1098px #FFF , 996px 1585px #FFF , 476px 69px #FFF , 123px 466px #FFF , 374px 414px #FFF , 741px 1097px #FFF , 1415px 1296px #FFF , 945px 1132px #FFF , 909px 2080px #FFF , 2219px 8px #FFF , 2198px 1039px #FFF , 1794px 1513px #FFF , 1484px 1972px #FFF , 1557px 2099px #FFF , 1385px 912px #FFF , 1612px 1474px #FFF , 169px 1963px #FFF;
    animation: animStar 175s linear infinite;
  }
  .stars2:after {
    content: " ";
    top: -600px;
    width: 3px;
    height: 3px;
    border-radius: 50%;
    position: absolute;
    backgroud: transparent;
    box-shadow: 148px 2112px #FFF , 2328px 2246px #FFF , 793px 1150px #FFF , 2476px 867px #FFF , 195px 2295px #FFF , 721px 1158px #FFF , 344px 1096px #FFF , 1434px 1247px #FFF , 2251px 1334px #FFF , 1696px 1404px #FFF , 1928px 1929px #FFF , 473px 1718px #FFF , 1176px 1364px #FFF , 133px 1990px #FFF , 1396px 1179px #FFF , 1355px 1046px #FFF , 676px 869px #FFF , 2255px 1676px #FFF , 2393px 2105px #FFF , 1032px 1390px #FFF , 773px 2159px #FFF , 1235px 945px #FFF , 1161px 209px #FFF , 1878px 175px #FFF , 287px 1787px #FFF , 509px 935px #FFF , 473px 442px #FFF , 1864px 177px #FFF , 768px 2004px #FFF , 513px 744px #FFF , 2060px 2271px #FFF , 2187px 2135px #FFF , 1818px 505px #FFF , 809px 1998px #FFF , 323px 2553px #FFF , 1420px 167px #FFF , 2418px 2233px #FFF , 1955px 2053px #FFF , 1822px 145px #FFF , 931px 629px #FFF , 94px 2440px #FFF , 1816px 718px #FFF , 386px 668px #FFF , 2040px 397px #FFF , 40px 866px #FFF , 1397px 2398px #FFF , 2399px 297px #FFF , 1611px 259px #FFF , 1393px 1139px #FFF;
  }
  .shooting-stars {
    z-index: 10;
    width: 5px;
    height: 85px;
    border-top-left-radius: 50%;
    border-top-right-radius: 50%;
    position: absolute;
    bottom: 0;
    right: 0;
    background: linear-gradient(to top, rgba(255, 255, 255, 0), white);
    animation: animShootingStar 10s linear infinite;
  }
  @keyframes animStar {
    from {
      transform: translateY(0px);
    }
    to {
      transform: translateY(-2560px) translateX(-2560px);
    }
  }
  @keyframes animShootingStar {
    from {
      transform: translateY(0px) translateX(0px) rotate(-45deg);
      opacity: 1;
      height: 5px;
    }
    to {
      transform: translateY(-2560px) translateX(-2560px) rotate(-45deg);
      opacity: 1;
      height: 800px;
    }
  }
  .sky {
  will-change: transform;
  transition: transform 0.1s ease-out;
	}
</style>
      <body>
        <div class="container">
          <div class="sky">
            <div class="stars"></div>
            <div class="stars1"></div>
            <div class="stars2"></div>
            <div class="shooting-stars"></div>
          </div>
        </div>
      </body>
      <script>
	  const sky = document.querySelector('.sky');
  window.addEventListener('mousemove', (e) => {
    const x = (e.clientX / window.innerWidth - 0.5) * 40;
    const y = (e.clientY / window.innerHeight - 0.5) * 40;
    sky.style.transform = `translate(${x}px, ${y}px)`;
  });
</script>
    </div>
  </div>
  <div class="ui_frame-wrap">
    <div class="disclaimer-box">
      <div class="disclaimer-box_top">
        <div data-typing="fast" class="paragraph is-disclaimer">visual<br>data</div>
        <div data-typing="fast" class="paragraph is-disclaimer">session7Dev</div>
        <div data-typing="fast" class="paragraph is-disclaimer">Active<br>reality</div>
      </div>
      <div class="disclaimer-box_middle">
        <div data-typing="fast" class="paragraph is-disclaimer is-spacing">https://www.thesomnia.com/chapter-I</div>
      </div>
      <div class="disclaimer-box_bottom">
        <div data-typing="fast" class="paragraph is-disclaimer">A dream is your mind’s response to a prompt you never wrote. Prompt your subconscious, Shape your dream</div>
      </div>
    </div>
    <div class="ui_frame"></div>
  </div>
  <nav class="ui">
    <div class="menu-container">
      <div class="menu_wrap">
        <div class="menu_bg">
          <div class="w-embed">
            <style>
	.menu_bg {
		backdrop-filter: blur(8px);
  	-webkit-backdrop-filter: blur(20px);
   }
 </style>
          </div>
        </div>
        <div class="menu-progress_wrapper">
          <div class="menu_nav-text">Chapter I : introduction</div>
          <div class="menu_crn-container">
            <div class="menu_crn-wrap is-btm-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
            <div class="menu_crn-wrap is-top-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
          </div>
        </div>
        <div data-w-id="4dbfcac2-f5c6-4e3d-56a3-50eeef466829" class="menu_dots-wrapper">
          <div class="menu_icon-wrap"><img src="images/menu-icon.svg" loading="lazy" alt="menu icon" class="menu-icon"></div>
          <div style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="menu_crn-container">
            <div class="menu_crn-wrap is-btm-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
            <div class="menu_crn-wrap is-btm-r"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
            <div class="menu_crn-wrap is-top-r"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
            <div class="menu_crn-wrap is-top-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
          </div>
        </div>
      </div>
      <div data-w-id="fc30f249-dbb6-7edc-eb49-37a21b7be029" class="menu_sound-wrap">
        <div class="text-block">Sound </div>
        <div style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="menu_crn-container">
          <div class="menu_crn-wrap is-btm-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
          <div class="menu_crn-wrap is-btm-r"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
          <div class="menu_crn-wrap is-top-r"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
          <div class="menu_crn-wrap is-top-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
        </div>
        <div class="menu_icon-wrap">
          <div style="height:0.3125rem" class="sound--rect is-1"></div>
          <div style="height:1.1875rem" class="sound--rect is-2"></div>
          <div style="height:1.1875rem" class="sound--rect is-2"></div>
          <div style="height:0.4375rem" class="sound--rect is-3"></div>
          <div style="height:0.9375rem" class="sound--rect is-4"></div>
        </div>
        <div class="menu_bg">
          <div class="w-embed">
            <style>
	.menu_bg {
		backdrop-filter: blur(8px);
  	-webkit-backdrop-filter: blur(8px);
   }
 </style>
          </div>
        </div>
      </div>
      <a href="index.html" class="w-inline-block">
        <div class="menu_logo-wrap">
          <div class="logo-container"><img src="images/The-Somnia.svg" loading="lazy" alt="the somnia logo"></div>
          <div class="menu_bg"></div>
          <div data-w-id="42c937ab-5742-eda0-b681-8adc3180cfa2" style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="menu_crn-container">
            <div class="menu_crn-wrap is-top-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
            <div class="menu_crn-wrap is-btm-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
            <div class="menu_crn-wrap is-top-r"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
            <div class="menu_crn-wrap is-btm-r"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
          </div>
        </div>
      </a>
      <link rel="prefetch" href="/">
    </div>
  </nav>
  <main class="app">
    <div class="content">
      <header class="section">
        <div class="section_hero">
          <div class="hero_head-wrap">
            <h1 data-filter="goo-6" class="h-h1">The Somnia</h1>
            <div class="hero_text-content">
              <h3 data-filter="goo-6" class="h-h3">Every night, your mind generates worlds you never asked for. Scroll down to learn how to take control over it.</h3>
            </div>
          </div>
        </div>
      </header>
      <div class="content-section">
        <div class="scroll_content"><img src="images/steps-circle.svg" loading="lazy" alt="" class="img-step">
          <div data-filter="goo-6" class="content_wrap para-1">
            <div class="paragraph is-eyebrow">Introduction</div>
            <h2 class="h-h2">What is a dream?</h2>
            <p class="paragraph">Your subconscious renders realities, blending memories, symbols, and desires into something new—much like AI generates images from a prompt. Most of the time, you aren’t the one prompting. Your mind pulls whatever data floats to the surface, creating a world that feels real but lacks direction.</p>
          </div>
          <div data-filter="goo-6" class="content_wrap para-2">
            <div class="paragraph is-eyebrow">Introduction</div>
            <h2 class="h-h2">Taking the first step into lucidity</h2>
            <p class="paragraph">Lucid dreaming turns sleep into conscious exploration. With the right approach, anyone can move beyond passive dreaming and learn to navigate the vast landscapes of the subconscious mind. It all starts with choosing the gateway that fits your nature best.</p>
          </div>
          <div data-filter="goo-6" class="content_wrap para-3">
            <div class="paragraph is-eyebrow">Shift</div>
            <h2 class="h-h2">Three pathways into lucid dreaming</h2>
            <p class="paragraph">Gaining lucidity is not a matter of luck—it’s a skill that can be trained. There are three primary methods recognized by leading researchers and practitioners that reliably open the gates to conscious dreaming. Each path activates different mechanics of the mind, allowing you to step beyond passive sleep and into deliberate exploration.</p>
          </div>
          <div data-filter="goo-6" class="content_wrap para-4">
            <div class="paragraph is-eyebrow">Method I</div>
            <h2 class="h-h2">Reality Testing</h2>
            <p class="paragraph">By training your mind to question reality during the day—through techniques like double-checking text or observing anomalies—you build the habit of recognizing dreams while inside them. This method, introduced by Dr. Stephen LaBerge, develops critical awareness that eventually triggers lucidity during sleep.</p>
          </div>
          <div data-filter="goo-6" class="content_wrap para-5">
            <div class="paragraph is-eyebrow">Method II</div>
            <h2 class="h-h2">Phase Entrance After Awakening</h2>
            <p class="paragraph">Described by Michael Raduga, this method leverages the moments of natural awakening. By setting alarms and performing targeted techniques during brief returns to wakefulness, you can transition directly into lucid dreams without losing consciousness.</p>
          </div>
          <div data-filter="goo-6" class="content_wrap para-6">
            <div class="paragraph is-eyebrow">Method III</div>
            <h2 class="h-h2">Wake-Initiated Lucid Dreaming (WILD)</h2>
            <p class="paragraph">This advanced method involves maintaining awareness as your body falls asleep. By riding the thin line between wakefulness and sleep, you can consciously slip into a dreamscape without ever losing your grip on consciousness.</p>
          </div>
        </div>
        <div class="scroll-trigger one"></div>
        <div class="scroll-trigger two"></div>
        <div class="scroll-trigger three"></div>
        <div class="scroll-trigger four"></div>
        <div class="scroll-trigger five"></div>
        <div class="scroll-trigger six"></div>
      </div>
      <div class="section">
        <div class="portal-track">
          <div class="portal-section">
            <div data-w-id="32e3ff3f-626a-79a9-6fde-1d974df06e1b" class="look-button">
              <div class="menu_nav-text">Enter The Dream</div>
              <div style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="menu_crn-container">
                <div class="menu_crn-wrap is-btm-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
                <div class="menu_crn-wrap is-btm-r"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
                <div class="menu_crn-wrap is-top-r"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
                <div class="menu_crn-wrap is-top-l"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img"><img src="images/corner.svg" loading="lazy" width="Auto" height="Auto" alt="" class="corner-img is-blur"></div>
              </div>
            </div>
            <div class="portal-overlay"></div>
            <div class="portal-bg"></div>
            <div class="portal-code w-embed w-script">
              <style>
    .portal-overlay {
      position: absolute;
      width: 100%;
      height: 100%;
      mask-image: radial-gradient(circle, rgba(0, 0, 0, 1) 25%, rgba(0, 0, 0, 0.75) 50%, rgba(0, 0, 0, 0.1) 65%, rgba(0, 0, 0, 0) 85%);
      mask-repeat: no-repeat;
      mask-size: 20vw 20vw;
      mask-position: center;
      transition: mask-size 1s ease;
      z-index: 2;
      background-size: cover;
      background-position: center;
      opacity: 0;
      transform: scale(0);
      transition: opacity 1s ease-out, transform 1s ease-out, mask-size 1s ease;
      pointer-events: none;
    }
    .portal-bg {
      position: absolute;
      width: 100%;
      height: 100%;
      mask-image: radial-gradient(circle, rgba(0, 0, 0, 1) 40%, rgba(0, 0, 0, 0.75) 50%, rgba(0, 0, 0, 0.1) 65%, rgba(0, 0, 0, 0) 85%);
      mask-repeat: no-repeat;
      mask-size: 25vw 25vw;
      mask-position: center;
      transition: mask-size 1s cubic-bezier(0.77, 0, 0.175, 1);
      z-index: 1;
      background-size: cover;
      background-position: center;
      opacity: 0;
      transform: scale(0);
      transition: opacity 1s ease-out, transform 1s ease-out, mask-size 1s cubic-bezier(0.77, 0, 0.175, 1);
      pointer-events: none;
    }
    .portal-overlay.expand {
      mask-size: 90vw 90vw;
      pointer-events: none;
    }
    .portal-bg.expand {
      mask-size: 95vw 95vw;
      pointer-events: none;
    }
    .portal-overlay.revealed,
    .portal-bg.revealed {
      opacity: 1;
      transform: scale(1);
      pointer-events: none;
    }
    .scene-content {
      opacity: 0;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      color: white;
      text-align: center;
      pointer-events: none;
      z-index: 10;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }
    .scene-content.visible {
      opacity: 1;
      pointer-events: auto;
      pointer-events: none;
    }
    /* Fade transitions for scene changes */
    .fade-transition {
      transition: opacity 0.5s ease;
      pointer-events: none;
    }
  </style>
              <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
              <script>
      document.addEventListener('DOMContentLoaded', function() {
    // Scene management
    let currentScene = 1;
    const totalScenes = 3;
    let isAnimating = false;
    // Scene data
    let sceneData = [
      {
        id: 1,
        title: "THE BOAT",
        overlayImage: "https://cdn.prod.website-files.com/67d67edc3ed28aa00cd5d1c0/67d6b2313ed28aa00cf64ab0_Red%20River.jpg",
        bgImage: "https://cdn.prod.website-files.com/67d67edc3ed28aa00cd5d1c0/67fdd22d5c713e16e54c2c42_the-island-bg.webp",
        content: "This is the story of The Boat. Lorem ipsum dolor sit amet..."
      },
      {
        id: 2,
        title: "THE ISLAND",
        overlayImage: "https://cdn.prod.website-files.com/67d67edc3ed28aa00cd5d1c0/67fdd22d8546d7fdf9609282_the-island-overlay.webp",
        bgImage: "https://cdn.prod.website-files.com/67d67edc3ed28aa00cd5d1c0/67fdd22d5c713e16e54c2c42_the-island-bg.webp",
        content: "Welcome to The Island. Lorem ipsum dolor sit amet..."
      },
      {
        id: 3,
        title: "THE ABYSS",
        overlayImage: "https://cdn.prod.website-files.com/67d67edc3ed28aa00cd5d1c0/67fdd2b28546d7fdf960ff15_the-abys.webp",
        bgImage: "https://cdn.prod.website-files.com/67d67edc3ed28aa00cd5d1c0/67fdd22d5c713e16e54c2c42_the-island-bg.webp",
        content: "Discover The Abyss. Lorem ipsum dolor sit amet..."
      }
    ];
    const portalSection = document.querySelector('.portal-section');
    const portalOverlay = document.querySelector('.portal-overlay');
    const portalBg = document.querySelector('.portal-bg');
    const lookButton = document.querySelector('.look-button');
    // Get text span inside lookButton (new logic)
    const lookButtonText = lookButton?.querySelector('.menu_nav-text');
    let sceneTitle = document.querySelector('.portal-section h2');
    let sceneIndicator = document.querySelector('.paragraph.is-eyebrow.big');
    const prevArrow = document.querySelector('.dream-arrow.l');
    const nextArrow = document.querySelector('.dream-arrow.r');
    if (!sceneIndicator && portalSection) {
      const indicator = document.createElement('div');
      indicator.className = 'scene-indicator';
      indicator.style.position = 'absolute';
      indicator.style.top = '30px';
      indicator.style.left = '50%';
      indicator.style.transform = 'translateX(-50%)';
      indicator.style.color = 'white';
      indicator.style.fontSize = '18px';
      indicator.style.zIndex = '10';
      portalSection.appendChild(indicator);
      sceneIndicator = document.querySelector('.scene-indicator');
    }
    if (!sceneTitle && portalSection) {
      const title = document.createElement('h2');
      title.className = 'scene-title';
      title.style.position = 'absolute';
      title.style.top = '170px';
      title.style.left = '50%';
      title.style.transform = 'translateX(-50%)';
      title.style.color = 'white';
      title.style.fontSize = '36px';
      title.style.zIndex = '10';
      title.style.margin = '0';
      portalSection.appendChild(title);
      sceneTitle = document.querySelector('.scene-title');
    }
    let sceneContent = document.querySelector('.portal-section .scene-content');
    if (!sceneContent && portalSection) {
      sceneContent = document.createElement('div');
      sceneContent.className = 'scene-content';
      sceneContent.style.position = 'absolute';
      sceneContent.style.top = '50%';
      sceneContent.style.left = '50%';
      sceneContent.style.transform = 'translate(-50%, -50%)';
      sceneContent.style.width = '80%';
      sceneContent.style.color = 'white';
      sceneContent.style.textAlign = 'center';
      sceneContent.style.opacity = '0';
      sceneContent.style.pointerEvents = 'none';
      sceneContent.style.zIndex = '10';
      portalSection.appendChild(sceneContent);
    }
    if (portalOverlay && portalBg) {
      updateSceneContent(currentScene);
      updateSceneIndicator();
    } else {
      console.error("Portal elements not found. Check your selectors.");
    }
    if (lookButton) {
      lookButton.addEventListener('click', togglePortalExpansion);
    } else {
      console.error("Look button not found. Check your selector.");
    }
    if (prevArrow) {
      prevArrow.addEventListener('click', function(e) {
        e.preventDefault();
        if (!isAnimating) goToPreviousScene();
      });
    }
    if (nextArrow) {
      nextArrow.addEventListener('click', function(e) {
        e.preventDefault();
        if (!isAnimating) goToNextScene();
      });
    }
    // Add ScrollTrigger initialization
    if (typeof ScrollTrigger !== 'undefined') {
      gsap.registerPlugin(ScrollTrigger);
      // Initial portal reveal animation
      ScrollTrigger.create({
        trigger: '.portal-section',
        start: 'top center',
        end: 'bottom center',
        onEnter: () => {
          requestAnimationFrame(() => {
            portalOverlay.classList.add('revealed');
            setTimeout(() => {
              portalBg.classList.add('revealed');
            }, 100);
          });
        },
        onLeaveBack: () => {
          if (portalOverlay.classList.contains('expand')) {
            togglePortalExpansion();
          }
          // Плавное исчезновение с задержкой
          portalBg.classList.remove('revealed');
          setTimeout(() => {
            portalOverlay.classList.remove('revealed');
          }, 100);
        }
      });
    }
    function togglePortalExpansion() {
      if (isAnimating || !portalOverlay || !portalBg || !portalOverlay.classList.contains('revealed')) return;
      isAnimating = true;
      const isExpanded = portalOverlay.classList.contains('expand');
      if (!isExpanded) {
        if (typeof gsap !== 'undefined') {
          gsap.to(portalOverlay, {
            maskSize: '90vw 90vw',
            duration: 1.2,
            ease: "power2.inOut"
          });
          gsap.to(portalBg, {
            maskSize: '95vw 95vw',
            duration: 1.4,
            ease: "power2.inOut",
            onComplete: () => {
              isAnimating = false;
              portalOverlay.classList.add('expand');
              portalBg.classList.add('expand');
            }
          });
          if (sceneContent) {
            gsap.to(sceneContent, {
              opacity: 1,
              delay: 0.5,
              duration: 0.8
            });
          }
        } else {
          portalOverlay.classList.add('expand');
          portalBg.classList.add('expand');
          setTimeout(() => {
            if (sceneContent) sceneContent.classList.add('visible');
            isAnimating = false;
          }, 500);
        }
        if (lookButtonText) {
          lookButtonText.textContent = 'Close';
        }
      } else {
        if (typeof gsap !== 'undefined') {
          gsap.to(portalOverlay, {
            maskSize: '20vw 20vw',
            duration: 1,
            ease: "power2.inOut"
          });
          gsap.to(portalBg, {
            maskSize: '25vw 25vw',
            duration: 1.2,
            ease: "power2.inOut",
            onComplete: () => {
              isAnimating = false;
              portalOverlay.classList.remove('expand');
              portalBg.classList.remove('expand');
            }
          });
          if (sceneContent) {
            gsap.to(sceneContent, {
              opacity: 0,
              duration: 0.4
            });
          }
        } else {
          if (sceneContent) sceneContent.classList.remove('visible');
          portalOverlay.classList.remove('expand');
          portalBg.classList.remove('expand');
          setTimeout(() => isAnimating = false, 1000);
        }
        if (lookButtonText) {
          lookButtonText.textContent = 'Enter The Dream';
        }
      }
    }
    function goToNextScene() {
      collapsePortalIfExpanded(() => {
        if (currentScene < totalScenes) {
          transitionToScene(currentScene + 1);
        } else {
          transitionToScene(1);
        }
      });
    }
    function goToPreviousScene() {
      collapsePortalIfExpanded(() => {
        if (currentScene > 1) {
          transitionToScene(currentScene - 1);
        } else {
          transitionToScene(totalScenes);
        }
      });
    }
    function transitionToScene(newScene) {
      if (isAnimating) return;
      isAnimating = true;
      const isExpanded = portalOverlay.classList.contains('expand');
      gsap.to([portalOverlay, portalBg], {
        opacity: 0,
        duration: 0.3,
        onComplete: () => {
          currentScene = newScene;
          updateSceneContent(currentScene);
          updateSceneIndicator();
          gsap.to([portalOverlay, portalBg], {
            opacity: 1,
            duration: 0.3,
            onComplete: () => {
              isAnimating = false;
              if (isExpanded) {
                gsap.set(portalOverlay, { maskSize: '90vw 90vw' });
                gsap.set(portalBg, { maskSize: '95vw 95vw' });
                if (sceneContent) {
                  gsap.to(sceneContent, {
                    opacity: 1,
                    duration: 0.4
                  });
                }
              }
            }
          });
        }
      });
    }
    function updateSceneContent(sceneNumber) {
      const scene = sceneData.find(scene => scene.id === sceneNumber);
      if (!scene) return;
      portalOverlay.style.backgroundImage = `url('${scene.overlayImage}')`;
      portalBg.style.backgroundImage = `url('${scene.bgImage}')`;
      if (sceneTitle) sceneTitle.textContent = scene.title;
      if (sceneContent) sceneContent.innerHTML = scene.content;
    }
    function updateSceneIndicator() {
      if (sceneIndicator) sceneIndicator.textContent = `${currentScene}/${totalScenes}`;
    }
    function collapsePortalIfExpanded(callback) {
      if (portalOverlay.classList.contains('expand')) {
        if (typeof gsap !== 'undefined') {
          isAnimating = true;
          gsap.to(portalOverlay, {
            maskSize: '20vw 20vw',
            duration: 1,
            ease: "power2.inOut"
          });
          gsap.to(portalBg, {
            maskSize: '25vw 25vw',
            duration: 1.2,
            ease: "power2.inOut",
            onComplete: () => {
              portalOverlay.classList.remove('expand');
              portalBg.classList.remove('expand');
              isAnimating = false;
              if (callback) callback();
            }
          });
          if (sceneContent) {
            gsap.to(sceneContent, {
              opacity: 0,
              duration: 0.4
            });
          }
          if (lookButtonText) {
            lookButtonText.textContent = 'Enter The Dream';
          }
        } else {
          if (sceneContent) sceneContent.classList.remove('visible');
          portalOverlay.classList.remove('expand');
          portalBg.classList.remove('expand');
          setTimeout(() => {
            isAnimating = false;
            if (callback) callback();
          }, 1000);
        }
      } else {
        if (callback) callback();
      }
    }
  });
  </script>
            </div>
            <div class="dream_header-wrapper">
              <p class="paragraph is-eyebrow big">1/3</p>
              <div class="dream_header-container">
                <div class="arrow-container">
                  <a href="#" class="dream-arrow-link w-inline-block"><img src="images/Arrow-dream.svg" loading="lazy" alt="arrow left" class="dream-arrow l"></a>
                </div>
                <div class="dream_header-name">
                  <h2 class="h-h2 uppercase">The boat</h2>
                </div>
                <div class="arrow-container">
                  <a href="#" class="dream-arrow-link w-inline-block"><img src="images/Arrow-dream.svg" loading="lazy" alt="arrow left" class="dream-arrow r"></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=67d67edc3ed28aa00cd5d1c0" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <script src="https://cdn.prod.website-files.com/gsap/3.13.0/gsap.min.js" type="text/javascript"></script>
  <script src="https://cdn.prod.website-files.com/gsap/3.13.0/ScrollTrigger.min.js" type="text/javascript"></script>
  <script src="https://cdn.prod.website-files.com/gsap/3.13.0/SplitText.min.js" type="text/javascript"></script>
  <script src="https://cdn.prod.website-files.com/gsap/3.13.0/InertiaPlugin.min.js" type="text/javascript"></script>
  <script type="text/javascript">gsap.registerPlugin(ScrollTrigger,SplitText,InertiaPlugin);</script><!--  Lenis библиотека  -->
  <script src="https://assets-global.website-files.com/6330c0ebacf06abbc83b6eb3/64103732523ba652052e0223_lenis-bundled.txt"></script>
  <script>
class Scroll extends Lenis{constructor(){super({duration:1.1,easing:e=>1===e?1:1-Math.pow(2,-13*e),direction:"vertical",smooth:!0,smoothTouch:!1,touchMultiplier:1.5}),this.time=0,this.isActive=!0,this.init()}init(){this.render()}render(){this.raf(this.time+=10),requestAnimationFrame(this.render.bind(this))}}window.SmoothScroll=new Scroll;const lenis=window.SmoothScroll;let scrollLocked=!1;function lockPageScroll(){scrollLocked||(scrollLocked=!0,lenis.stop(),document.documentElement.style.overflow="hidden")}function unlockPageScroll(){scrollLocked&&(scrollLocked=!1,lenis.start(),document.documentElement.style.overflow="")}let sectionLocked=!1;function checkLockTargets(){let e=document.querySelectorAll("[data-scroll-lock]"),o=.5*window.innerHeight,t=[...e].some(e=>{let t=e.getBoundingClientRect();return t.top<o&&t.bottom>o});t&&!sectionLocked?(lenis.stop(),document.documentElement.style.overflow="hidden",sectionLocked=!0):!t&&sectionLocked&&(lenis.start(),document.documentElement.style.overflow="",sectionLocked=!1),requestAnimationFrame(checkLockTargets)}requestAnimationFrame(checkLockTargets);
</script>
  <style>
/* Стили для WebGL canvas */
.portal-section .transition-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1.5;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    /* Добавляем маску */
    mask-image: radial-gradient(circle, rgba(0, 0, 0, 1) 25%, rgba(0, 0, 0, 0.75) 50%, rgba(0, 0, 0, 0.1) 65%, rgba(0, 0, 0, 0) 85%);
    -webkit-mask-image: radial-gradient(circle, rgba(0, 0, 0, 1) 25%, rgba(0, 0, 0, 0.75) 50%, rgba(0, 0, 0, 0.1) 65%, rgba(0, 0, 0, 0) 85%);
    mask-size: 20vw 20vw;
    -webkit-mask-size: 20vw 20vw;
    mask-position: center;
    -webkit-mask-position: center;
    mask-repeat: no-repeat;
    -webkit-mask-repeat: no-repeat;
    transition: mask-size 1s cubic-bezier(0.77, 0, 0.175, 1), -webkit-mask-size 1s cubic-bezier(0.77, 0, 0.175, 1), opacity 0.3s ease;
    pointer-events: none;
}
.portal-section .transition-canvas.active {
    opacity: 1;
    pointer-events: none;
}
.portal-section .transition-canvas.expand {
    mask-size: 90vw 90vw;
    -webkit-mask-size: 90vw 90vw;
    pointer-events: none;
}
canvas {
	    pointer-events: none;
}
</style>
  <script src="https://cdn.jsdelivr.net/gh/chipas111/the-somnia@1a2147b/portal-effect.js"></script>
  <script>
document.addEventListener('DOMContentLoaded', async function() {
    // Создаем отдельный canvas для WebGL анимации
    const transitionCanvas = document.createElement('canvas');
    transitionCanvas.classList.add('transition-canvas');
    document.querySelector('.portal-section').appendChild(transitionCanvas);
    // Инициализируем WebGL эффект
    window.portalEffect = new PortalEffect(transitionCanvas);
    // Находим элементы
    const prevArrow = document.querySelector('.dream-arrow.l');
    const nextArrow = document.querySelector('.dream-arrow.r');
    const lookButton = document.querySelector('.look-button');
    const portalOverlay = document.querySelector('.portal-overlay');
    const portalBg = document.querySelector('.portal-bg');
    // Массив с изображениями
    const sceneImages = [
        "https://cdn.prod.website-files.com/67d67edc3ed28aa00cd5d1c0/67d6b2313ed28aa00cf64ab0_Red%20River.jpg",
        "https://cdn.prod.website-files.com/67d67edc3ed28aa00cd5d1c0/67fdd22d8546d7fdf9609282_the-island-overlay.webp",
        "https://cdn.prod.website-files.com/67d67edc3ed28aa00cd5d1c0/67fdd2b28546d7fdf960ff15_the-abys.webp"
    ];
    let isTransitioning = false;
    // Функция для анимации перехода между сценами
    async function animateTransition(fromIndex, toIndex) {
        if (isTransitioning) return;
        isTransitioning = true;
        // Активируем canvas
        transitionCanvas.classList.add('active');
        // Устанавливаем текстуры
        await window.portalEffect.setTextures(
            sceneImages[fromIndex],
            sceneImages[toIndex]
        );
        // Анимируем переход
        const duration = 1000;
        const startTime = performance.now();
        function animate() {
            const currentTime = performance.now();
            const progress = Math.min((currentTime - startTime) / duration, 1);
            window.portalEffect.setProgress(progress);
            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                // Скрываем canvas после завершения анимации
                transitionCanvas.classList.remove('active');
                isTransitioning = false;
            }
        }
        animate();
    }
    // Функция для анимации погружения и всплытия
    async function animatePortalToggle(isExpanding) {
        if (isTransitioning) return;
        isTransitioning = true;
        const currentScene = parseInt(document.querySelector('.paragraph.is-eyebrow.big')?.textContent?.split('/')[0] || '1') - 1;
        // Активируем canvas
        transitionCanvas.classList.add('active');
        // Устанавливаем текстуры в зависимости от направления анимации
        if (isExpanding) {
            // При расширении используем одно и то же изображение
            await window.portalEffect.setTextures(
                sceneImages[currentScene],
                sceneImages[currentScene]
            );
        } else {
            // При сжатии используем текущее изображение и фоновое
            const nextScene = (currentScene + 1) % sceneImages.length;
            await window.portalEffect.setTextures(
                sceneImages[currentScene],
                sceneImages[nextScene]
            );
        }
        // Синхронизируем маску с анимацией портала
        if (isExpanding) {
            transitionCanvas.classList.add('expand');
        } else {
            transitionCanvas.classList.remove('expand');
        }
        // Анимируем эффект
        const duration = isExpanding ? 1400 : 1200;
        const startTime = performance.now();
        function animate() {
            const currentTime = performance.now();
            const progress = Math.min((currentTime - startTime) / duration, 1);
            // При расширении и сжатии используем разную логику прогресса
            if (isExpanding) {
                // При расширении эффект идет от края к центру
                window.portalEffect.setProgress(1 - progress);
            } else {
                // При сжатии эффект идет от центра к краю
                window.portalEffect.setProgress(progress);
            }
            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                if (!isExpanding) {
                    transitionCanvas.classList.remove('active');
                }
                isTransitioning = false;
            }
        }
        animate();
    }
    // Обработчик для кнопки Look
    if (lookButton) {
        const originalClick = lookButton.onclick;
        lookButton.onclick = null;
        lookButton.addEventListener('click', async function(e) {
            if (isTransitioning) {
                e.preventDefault();
                return;
            }
            const isExpanding = !portalOverlay.classList.contains('expand');
            animatePortalToggle(isExpanding);
            // Вызываем оригинальный обработчик
            if (originalClick) {
                originalClick.call(this, e);
            }
        });
    }
    // Обработчики для кнопок навигации
    if (prevArrow) {
        const originalClick = prevArrow.onclick;
        prevArrow.onclick = null;
        prevArrow.addEventListener('click', async function(e) {
            if (isTransitioning) {
                e.preventDefault();
                return;
            }
            const currentScene = parseInt(document.querySelector('.paragraph.is-eyebrow.big')?.textContent?.split('/')[0] || '1');
            const fromIndex = currentScene - 1;
            const toIndex = currentScene > 1 ? currentScene - 2 : 2;
            animateTransition(fromIndex, toIndex);
            if (originalClick) {
                originalClick.call(this, e);
            }
        });
    }
    if (nextArrow) {
        const originalClick = nextArrow.onclick;
        nextArrow.onclick = null;
        nextArrow.addEventListener('click', async function(e) {
            if (isTransitioning) {
                e.preventDefault();
                return;
            }
            const currentScene = parseInt(document.querySelector('.paragraph.is-eyebrow.big')?.textContent?.split('/')[0] || '1');
            const fromIndex = currentScene - 1;
            const toIndex = currentScene < 3 ? currentScene : 0;
            animateTransition(fromIndex, toIndex);
            if (originalClick) {
                originalClick.call(this, e);
            }
        });
    }
    // Инициализация ScrollTrigger
    if (typeof ScrollTrigger !== 'undefined') {
        gsap.registerPlugin(ScrollTrigger);
        ScrollTrigger.create({
            trigger: '.portal-section',
            start: 'top center',
            end: 'bottom center',
            onEnter: () => {
                transitionCanvas.classList.add('active');
                window.portalEffect.setProgress(0);
            },
            onLeaveBack: () => {
                transitionCanvas.classList.remove('active');
            }
        });
    }
});
</script>
</body>
</html>